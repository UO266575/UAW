<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyecto Velutinas</title>
  <link rel="stylesheet" href="style/nav.css">
  <link rel="stylesheet" href="style/footer.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="style/velutinas.css" />
  <link rel="stylesheet" href="style/style.css" />
</head>

<body>

  <header>
    <div class="topnav" id="myTopnav">
      <div class="logo">UAW</div>
      <div class="link-items">
        <a href="index.html">Inicio</a>
        <a href="velutinas.html">Proyectos</a>
        <a href="#">¿Qué hacemos?</a>
        <a href="contact.html">Contacto</a>
      </div>
      <a href="javascript:void(0);" class="icon" onclick="myFunction()">
        <i class="fa fa-bars"></i>
      </a>
    </div>
  </header>

  <main>
    <h1>Velutinas</h1>
    <hr>
    <p class="quote">En España nos enfrentamos a una creciente preocupación ambiental y social debido a la invasión de
      la <b>avispa velutina</b>, una especie invasora que amenaza la biodiversidad local y la apicultura. Para combatir
      este problema, nuestro proyecto se centra en la colocación de <b>100 trampas</b> caseras distribuidas a lo largo
      de la región de Asturias. Esta iniciativa busca mitigar el impacto de las velutinas y <b>proteger nuestro
        ecosistema</b>, mientras se fomenta la concienciación comunitaria sobre la importancia de preservar el delicado
      equilibrio de nuestra naturaleza.</p>
    <hr>
    <div id="popup1" class="overlay">
      <div class="close-container">
        <a class='close' href='#'>CERRAR</a>
      </div>
      <div class="popup">
        <!-- <a class='close' href='#'>&times;</a> -->
        <div id="trap-info"></div>
      </div>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <div class="map-container">
      <h2>Mapa</h2>
      <div id="map"></div>
      <div class="w3-border w3-large">
        <div id="traps-progress" class="w3-container w3-padding-large w3-green w3-center w3-round"
          style="height:50px;width:0%">0%</div>
      </div>
      <br>
      <p id="traps-info">18 de 100 trampas colocadas</p>
    </div>
    <footer>
      <div class="row">
        <a href="#"><i class="fa fa-facebook"></i></a>
        <a href="#"><i class="fa fa-instagram"></i></a>
        <a href="#"><i class="fa fa-youtube"></i></a>
        <a href="#"><i class="fa fa-twitter"></i></a>
      </div>
      <div class="row">
        PLACEHOLDER Copyright © 2024 - José Antonio Pérez
      </div>
    </footer>
  </main>


  <script>
    var mymap = L.map('map').setView([43.3623, -5.8448], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(mymap);

    fetch('data/markers.json')
      .then(response => response.json())
      .then(data => {
        data.forEach(marker => {
          var popupContent = "<b>Nombre:</b> " + marker.name;
          var markerPopup = L.popup().setContent(popupContent);
          var mapMarker = L.marker([marker.lat, marker.lng]).addTo(mymap);
          mapMarker.bindPopup(markerPopup);

          mapMarker.on('click', function () {
            var popup = document.getElementById('popup1');
            popup.style.visibility = 'visible';
            popup.style.opacity = '1';

            var trapInfo = document.getElementById('trap-info');
            var popupContent = "<h2>Identificador:</h2><p>" + marker.name + "</p><h2>Fecha:</h2><p>" + marker.date + "</p><h2>Coordenadas:</h2><p>" + marker.lat + ", " + marker.lng + "</p><h2>Fotografía:</h2><img src='./img/velutinas_traps/" + marker.name + ".jpg'>";
            if (marker.reviews && marker.reviews.length > 0) {
              popupContent += "<h2>Revisiones:</h2><table><tr><th>Fecha de Revisión</th><th>Reinas Atrapadas</th><th>Obreras Atrapadas</th></tr>";
              marker.reviews.forEach(review => {
                popupContent += "<tr><td>" + review.revision_date + "</td><td>" + review.caught_queens + "</td><td>" + review.worker_wasps + "</td></tr>";
              });
              popupContent += "</table>";
            } else {
              popupContent += "<p>No hay revisiones disponibles.</p>";
            }
            trapInfo.innerHTML = popupContent;
          });
        });
        var trapsProgress = document.getElementById('traps-progress');
        var trapsInfo = document.getElementById('traps-info');
        var numMarkers = data.length;
        var finalWidth = (numMarkers / 100) * 100;
        var currentWidth = 0;

        function increaseProgress() {
          if (currentWidth >= finalWidth) {
            clearInterval(progressInterval);
          } else {
            currentWidth++;
            trapsProgress.style.width = currentWidth + '%';
            trapsProgress.textContent = currentWidth + '%';
            trapsInfo.textContent = numMarkers + ' de 100 trampas colocadas';
          }
        }

        var progressInterval = setInterval(increaseProgress, 30);
      });

    function myFunction() {
      var x = document.getElementById("myTopnav");
      if (x.className === "topnav") {
        x.className += " responsive";
      } else {
        x.className = "topnav";
      }
    }

    document.querySelector('.close').addEventListener('click', function (event) {
      event.preventDefault();
      var popup = document.getElementById('popup1');
      popup.style.visibility = 'hidden';
      popup.style.opacity = '0';
    });
  </script>

</body>

</html>